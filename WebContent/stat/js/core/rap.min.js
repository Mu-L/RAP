"use strict";var rap=rap||{};(function(){rap.util=rap.util||{};var e=rap.util,t=baidu;e.escaper=e.escaper||{};e.escaper.escapeInHJ=function(e){e.replace(/\&/g,"&");e=e.replace(/\</g,"&lt;");e=e.replace(/\>/g,"&gt;");e=e.replace(/\\/g,"\\\\");e=e.replace(/\//g,"\\/");e=e.replace(/\'/g,"\\&#39;");e=e.replace(/\"/g,"\\&quot;");e=e.replace(/\r/g,"\\r");e=e.replace(/\n/g,"\\n");return e};e.escaper.escapeInJ=function(e){e=e.replace(/\\/g,"\\\\");e=e.replace(/\//g,"\\/");e=e.replace(/\'/g,"\\&#39;");e=e.replace(/\"/g,"\\&quot;");return e};e.escaper.escapeInH=t.encodeHTML;e.escaper.escapeInU=encodeURIComponent;e.hint=function(){function s(){i=t.g("DIV_NAME");if(!i){i=document.createElement("div");i.id="tipDiv"}document.body.appendChild(i);return i}var e="tipDiv",n={},r=true,i=null;n.init=function(){var e=t.g("checkboxHintEnabled");if(e){r=e.checked}};n.bind=function(e,n){e=typeof e=="string"?t.g(e):e;if(e&&n){t.event.on(e,"mouseover",function(){rap.util.hint.show(this,n)});t.event.on(e,"mouseout",function(){rap.util.hint.hide()})}};n.show=function(t,n){if(!r)return;var o=baidu.dom.getPosition(t);var u=i?i:s();u.innerHTML=n;baidu.show(e);if(o.top+u.offsetHeight>baidu.page.getViewHeight()+baidu.page.getScrollTop()){baidu.setStyle(e,"top",baidu.page.getViewHeight()+baidu.page.getScrollTop()-u.offsetHeight)}else{baidu.setStyle(e,"top",o.top)}if(o.left+t.offsetWidth+u.offsetWidth>baidu.page.getViewWidth()){baidu.setStyle(e,"left",o.left-u.offsetWidth)}else{baidu.setStyle(e,"left",o.left+t.offsetWidth)}};n.hide=function(){if(!r)return;t.hide(i)};n.enable=function(){r=true};n.disable=function(){r=false};return n}();e.validator=function(){function e(t){if(t._sValue!==undefined){return false}t=baidu.G(t);var n=e;var r=t.getAttribute("validate")||t.name;var i=t.getAttribute("trim")!="no"?baidu.trim(t.value):t.value;var s=n._pattern(i,r,t.getAttribute("pattern"))||n._number(i,r,t.getAttribute("maxValue"),t.getAttribute("minValue"))||n._length(i,r,t.getAttribute("maxLen"),t.getAttribute("minLen"),t.getAttribute("character")!==false)||n._custom(i,r,t.getAttribute("custom"));if(s){s=t.getAttribute("message")||s;if(!t.onInvalid){var o=t.getAttribute("invalid");if(o){n=baidu.G(o);if(n){t._eMsg=n;t.onInvalid=function(e){this._eMsg.innerHTML=e};t.onValid=function(){this._eMsg.innerHTML=""}}else{t.onInvalid=window[o];t.onValid=t.onInvalid.valid}}else{t.onInvalid=function(){this._sValue=this.value;baidu.addClass(this,"invalid");this.value=s;this.onfocus=function(){baidu.removeClass(this,"invalid");var e=this._sValue;if(e!==undefined){this.value=e;this._sValue=undefined}}}}}try{t.onInvalid(s)}catch(u){}return false}t.value=i;t.onValid&&t.onValid();return true}e.ERR_SUBMIT="数据无法向服务器提交";e.AFFIRM_REMOVE="真的要删除它吗？";e.ERR_REQUIRED="#{0}不能为空";e.ERR_LEAST_LETTER="#{0}至少需要包含#{1}字节";e.ERR_MOST_LETTER="#{0}最多只能包含#{1}字节";e.ERR_LEAST_CHAR="#{0}至少需要包含#{1}字符";e.ERR_MOST_CHAR="#{0}最多只能包含#{1}字符";e.ERR_MINIMUL="#{0}必须大于#{1}";e.ERR_MAXIMUL="#{0}必须小于#{1}";e.ERR_INVAILD="#{0}无效";e.validElement=function(t){var n=t.getElementsByTagName("*");var r=true;for(var i=0,s;s=n[i];i++){var o=s.tagName.toLowerCase();if((o=="input"||o=="select"||o=="textarea")&&(s.offsetWidth||s.type=="hidden")&&!e(s)){r=false}}return r};e.validForm=function(t){var n=t;var r=true;for(var i=0,s;s=n[i];i++){if((s.offsetWidth||s.type=="hidden")&&!e(s)){r=false}}return r};e._pattern=function(t,n,r){if(r&&!t.match(new RegExp("^"+r+"$"))){return baidu.format(e.ERR_INVAILD,[n])}};e._number=function(t,n,r,i){if(r||i){if(!t.match(/^[0-9]+(\.[0-9]+)?$/)){return baidu.format(e.ERR_INVAILD,[n])}else{t=parseInt(t,10);if(r!==null&&t>parseInt(r,10)){return baidu.format(e.ERR_MAXIMUL,[n,r])}if(i!==null&&t<parseInt(i,10)){return baidu.format(e.ERR_MINIMUL,[n,i])}}}};e._length=function(t,n,r,i,s){if(r||i){var o=s?t.length:baidu.string.getByteLength(t);if(r&&o>parseInt(r,10)){return s?baidu.format(e.ERR_MOST_CHAR,[n,r]):baidu.format(e.ERR_MOST_LETTER,[n,r])}if(i&&o<parseInt(i,10)){return o?s?baidu.format(e.ERR_LEAST_CHARname,[i]):baidu.format(e.ERR_LEAST_LETTER,[n,i]):baidu.format(e.ERR_REQUIRED,[n])}}};e._custom=function(e,t,n){if(n){return window[n](e,t)}};return e}()})(this);(function(){function r(){var e={};e.id=u();e.identifier="";e.name="";e.remark="";e.validator="";e.dataType="";e.parameterList=[];return e}function i(e,t){var n=e.parameterList,r=n&&n.length?n.length:0;for(var s=0;s<r;s++){var o=n[s];if(o.id==t){n.splice(s,1);return 0}if(i(o,t)==0){return 0}}return-1}function s(e,t){var n=e.parameterList,r=n&&n.length?n.length:0;for(var i=0;i<r;i++){var o=n[i];if(o.id==t){return o}var u=s(o,t);if(u){return u}}return null}function u(){return(new Date).getTime()-1283136075795+o++}rap.project=rap.project||{};var e=rap.project,t=baidu,n=null;e.init=function(e){n=e};e.getId=function(){return n.id};e.getVersion=function(){return n.version};e.getModuleList=function(){return n.moduleList};e.getModule=function(e){var t=n.moduleList,r=t.length;for(var i=0;i<r;i++){if(t[i].id==e){return t[i]}}return null};e.getAction=function(e){var t=n.moduleList,r=t.length;for(var i=0;i<r;i++){var s=t[i],o=s.pageList,u=o.length;for(var a=0;a<u;a++){var f=o[a],l=f.actionList,c=l.length;for(var h=0;h<c;h++){var p=l[h];if(p.id==e){return p}}}}return null};e.findNextParameter=function(e,t){var n=this.getAction(e);if(n){var r=n.requestParameterList,i=r.length,s=n.responseParameterList,o=s.length;for(var u=0;u<i;u++){var a=r[u];if(a.id==t){if(u+1<i){return r[u+1].id}return-1}}for(var u=0;u<o;u++){var a=s[u];if(a.id==t){if(u+1<o){return s[u+1].id}return-1}}}return-1};e.isRequestParameter=function(e,t){var n=this.getAction(e);if(n){var r=n.requestParameterList,i=r.length;for(var s=0;s<i;s++){if(r[s].id==t){return true}}}return false};e.isResponseParameter=function(e,t){var n=this.getAction(e);if(n){var r=n.responseParameterList,i=r.length;for(var s=0;s<i;s++){if(r[s].id==t){return true}}}return false};e.getPageList=function(e){return this.getModule(e).pageList};e.getPage=function(e){var t=n.moduleList,r=t.length;for(var i=0;i<r;i++){var s=t[i],o=s.pageList,u=o.length;for(var a=0;a<u;a++){if(o[a].id==e){return o[a]}}}return null};e.getActionIndexAndActionList=function(e){var t=n.moduleList,r=t.length;for(var i=0;i<r;i++){var s=t[i],o=s.pageList,u=o.length;for(var a=0;a<u;a++){var f=o[a],l=f.actionList,c=l.length;for(var h=0;h<c;h++){var p=l[h];if(p.id==e){return{actionIndex:h,actionList:l}}}}}return null};e.getPageIndexAndPageList=function(e){var t=n.moduleList,r=t.length;for(var i=0;i<r;i++){var s=t[i],o=s.pageList,u=o.length;for(var a=0;a<u;a++){var f=o[a];if(f.id==e){return{pageIndex:a,pageList:o}}}}};e.updateAction=function(e){var t=this.getAction(e.id);if(t!=null){t.name=e.name;t.requestType=e.requestType;t.requestUrl=e.requestUrl;t.responseTemplate=e.responseTemplate;t.description=e.description}};e.updatePage=function(e){var t=this.getPage(e.id);if(t!=null){t.name=e.name;t.introduction=e.introduction}};e.getData=function(){return n};e.addModule=function(){var e=u();n.moduleList.push({id:e,name:"",introduction:"",pageList:[]});return e};e.addAction=function(e){e.id=u();e.requestParameterList=[];e.responseParameterList=[];this.getPage(e.pageId).actionList.push(e);return e.id};e.addPage=function(e){e.id=u();e.isIdGenerated=true;e.actionList=[];this.getModule(e.moduleId).pageList.push(e)};e.addRequestParameter=function(e){var t=r();this.getAction(e).requestParameterList.push(t);return t.id};e.addResponseParameter=function(e){var t=r();this.getAction(e).responseParameterList.push(t);return t.id};e.addChildParameter=function(e){var t=this.getParameter(e);if(t!=null){var n=r();t.parameterList.push(n);return n.id}return-1};e.removeModule=function(e){var r=this.getModule(e);if(r==null)return;t.array.remove(n.moduleList,r)};e.removeAction=function(e){var t=this.getActionIndexAndActionList(e);if(t==null)return;t.actionList.splice(t.actionIndex,1)};e.removeParameter=function(e){var t=n.moduleList,r=t.length;for(var s=0;s<r;s++){var o=t[s],u=o.pageList,a=u.length;for(var f=0;f<a;f++){var l=u[f],c=l.actionList,h=c.length;for(var p=0;p<h;p++){var d=c[p],v=d.requestParameterList,m=v.length,g=d.responseParameterList,y=g.length;for(var b=0;b<m;b++){var w=v[b];if(w.id==e){v.splice(b,1);return 0}if(i(w,e)==0){return 0}}for(var b=0;b<y;b++){var w=g[b];if(w.id==e){g.splice(b,1);return 0}if(i(w,e)==0){return 0}}}}}return-1};e.removePage=function(e){var t=this.getPageIndexAndPageList(e);if(t==null)return;t.pageList.splice(t.pageIndex,1)};e.setModuleName=function(e,t){var n=this.getModule(e);if(n){n.name=t}};e.setParameter=function(e,t,n){var r=this.getParameter(e);if(r==null)return;r[n]=t};e.setParameterObj=function(e,t){if(!e||!e.id||!t||!t.id)return;e.name=t.name;e.dataType=t.dataType;e.identifier=t.identifier;e.parameterList=t.parameterList;e.remark=t.remark;e.validator=t.validator};e.getParameter=function(e){var t=n.moduleList,r=t.length;for(var i=0;i<r;i++){var o=t[i],u=o.pageList,a=u.length;for(var f=0;f<a;f++){var l=u[f],c=l.actionList,h=c.length;for(var p=0;p<h;p++){var d=c[p],v=d.requestParameterList,m=v.length,g=d.responseParameterList,y=g.length;for(var b=0;b<m;b++){var w=v[b];if(w.id==e)return w;var E=s(w,e);if(E){return E}}for(var b=0;b<y;b++){var w=g[b];if(w.id==e)return w;var E=s(w,e);if(E){return E}}}}}return null};e.parameterAutoComplete=function(e){var t=this.getParameter(e);var r=n.moduleList,i=r.length;for(var s=i-1;s>-1;s--){var o=r[s],u=o.pageList,a=u.length;for(var f=a-1;f>-1;f--){var l=u[f],c=l.actionList,h=c.length;for(var p=h-1;p>-1;p--){var d=c[p],v=d.requestParameterList,m=v.length,g=d.responseParameterList,y=g.length;for(var b=m-1;b>-1;b--){var w=v[b];if(this.parameterAutoCompleteRecursively(w,t)){return true}}for(var b=y-1;b>-1;b--){var w=g[b];if(this.parameterAutoCompleteRecursively(w,t)){return true}}}}}};e.parameterAutoCompleteRecursively=function(n,r){if(!n||!r)return;if((n.name==r.name&&n.name!=""||n.identifier==r.identifier&&r.identifier!="")&&n.id!=r.id){var i=t.object.clone(n);e.resetAllChildParameterId(i);this.setParameterObj(r,i);return true}var s=n.parameterList;if(!s)return;var o=s.length;for(var u=o-1;u>-1;u--){if(this.parameterAutoCompleteRecursively(s[u],r))return true}};e.isActionInModule=function(t,n){var r=e.getModule(n);if(!r)return false;var i=r.pageList,s=i.length;for(var o=0;o<s;o++){var u=i[o],a=u.actionList,f=a.length;for(var l=0;l<f;l++){if(a[l].id==t){return true}}}return false};var o=1;e.isEmpty=function(){return n.moduleList.length==0};e.resetAllChildParameterId=function(t){if(!t||!t.id||!t.parameterList)return;var n=t.parameterList,r=n.length;for(var i=0;i<r;i++){var s=n[i];s.id=u();e.resetAllChildParameterId(s)}}})();(function(){function processInputEvent(e){var t=e?b.event.on:b.event.un;t(ELEMENT_ID.EDIT_INPUT,CONFIG.KEYPRESS_EVENT_NAME,keypressEventHandler)}function focusElement(e){if(!e)return;if(b.browser.ie){setTimeout(function(){e.focus()},200)}else{e.focus()}}function debug(e){var t=window.console||{};if(t.log){t.log(e)}var n=b.g("div-debug");if(n){n.innerHTML="debug["+_debugCounter++ +"]:"+e}}function validate(e){return rap.util.validator.validForm(document.forms[e])}function hideAllChildParameters(e){if(!e||!e.parameterList||e.parameterList<=0)return;var t=e.parameterList,n=t.length;for(var r=0;r<n;r++){var i=t[r];hideParam(i);hideAllChildParameters(i)}}function showAllChildParameters(e){if(!e||!e.parameterList||e.parameterList<=0)return;var t=e.parameterList,n=t.length;for(var r=0;r<n;r++){var i=t[r];showParam(i);showAllChildParameters(i)}}function showParam(e){b.show("tr-param-"+e.id)}function hideParam(e){b.hide("tr-param-"+e.id)}function setButtonsViewState(e){if(e==CONST.EDIT){b.hide("btnExport");b.hide("btnEdit");b.hide("btnVersion");b.show("btnSave");b.show("btnFastSave");b.show("btnCancel");b.show("div-add-p");b.hide("btnExitVersion")}else if(e==CONST.NORMAL){b.show("btnExport");b.show("btnEdit");b.show("btnVersion");b.hide("btnSave");b.hide("btnFastSave");b.hide("btnCancel");b.hide("div-add-p");b.hide("btnExitVersion")}else if(e==CONST.VERSION){b.hide("btnExport");b.hide("btnEdit");b.show("btnVersion");b.hide("btnSave");b.hide("btnFastSave");b.hide("btnCancel");b.hide("div-add-p");b.show("btnExitVersion")}}function sessionDelay(){b.ajax.get(URL.ping,function(xhr,response){try{var obj=eval("("+response+")");if(obj.isOk){}else{showMessage(CONST.WARN,ELEMENT_ID.WORKSPACE_MESSAGE,MESSAGE.SESSION_DELAY_ERROR)}}catch(e){showMessage(CONST.WARN,ELEMENT_ID.WORKSPACE_MESSAGE,MESSAGE.SESSION_DELAY_ERROR)}})}function storeViewState(){_viewState.moduleId=_curModuleId;_viewState.actionId=_curActionId;if(_curActionId>0&&_curModuleId>0){var e=getDiv(_curModuleId,"a");if(e){_viewState.actionScrollTop=e.scrollTop;_viewState.actionScrollLeft=e.scrollLeft}var t=getDiv(_curModuleId,"tree");if(t){_viewState.moduleTreeScrollTop=t.scrollTop;_viewState.moduleTreeScrollLeft=t.scrollLeft}}}function recoverViewState(){if(_viewState.moduleId>0){if(p.getModuleList().length>1){ws.switchM(_viewState.moduleId)}if(_viewState.actionId>0&&p.isActionInModule(_viewState.actionId,_viewState.moduleId)){ws.switchA(_viewState.actionId);var e=getDiv(_curModuleId,"a");if(e){e.scrollTop=_viewState.actionScrollTop+"";e.scrollLeft=_viewState.actionScrollLeft+""}var t=getDiv(_curModuleId,"tree");if(t){t.scrollTop=_viewState.moduleTreeScrollTop;t.scrollLeft=_viewState.moduleTreeScrollLeft}}}}function isRubbishIE(){return-[1]?false:true}function putObjectIntoDeletedPool(e,t){if(!_deletedObjectList){_deletedObjectList=[]}if(e&&t){_deletedObjectList.push({className:e,id:t})}}function switchToViewModeSub(){setButtonsViewState(CONST.NORMAL);_isEditMode=false;initModules();recoverViewState()}function getWorkspaceJsonString(){return b.json.stringify(_data)}function getProjectDataJson(){return b.json.stringify(p.getData())}function getDivId(e,t){return"div-"+t+"-"+e}function getDiv(e,t){return b.g(getDivId(e,t))}function getTdId(e,t){return"td-"+t+"-"+e}function getTd(e,t){return b.g(getTdId(e,t))}function getTrId(e,t){return"tr-"+t+"-"+e}function getTr(e,t){return b.g(getTrId(e,t))}function keypressEventHandler(e){var t=b.event.getKeyCode(e);if(t==13){var n=b.object.clone(_editContext);var r=ws.finishEdit();if(e.ctrlKey&&r){var i=p.parameterAutoComplete(r);if(i){ws.switchA(_curActionId);if(n==null)return;var s=n.id;var o=p.findNextParameter(_curActionId,s);if(o>0){ws.edit(o,"param-name")}else if(p.isRequestParameter(_curActionId,s)){ws.addParam("request")}else if(p.isResponseParameter(_curActionId,s)){ws.addParam("response")}}else{ws.edit(n.id,"param-identifier")}}}else if(t==27){cancelEdit()}else if(t==9){if(e.preventDefault){e.preventDefault()}else{e.returnValue=null}switch(_editContext.key){case"param-identifier":ws.edit(_editContext.id,"param-name");break;case"param-name":var u=b.g("select-dataType-"+_editContext.id);focusElement(u);break;case"param-remark":if(_editContext==null)return;var s=_editContext.id;var o=p.findNextParameter(_curActionId,s);if(o>0){ws.edit(o,"param-name")}else if(p.isRequestParameter(_curActionId,s)){ws.addParam("request")}else if(p.isResponseParameter(_curActionId,s)){ws.addParam("response")}break}}}function renderA(){var e=b.q("js-code-area"),t=e.length,n=0;for(;n<t;n++){var r=e[n];r.innerHTML=r.innerHTML.formatJS()}e=b.q("div-a-desc-expander");t=e.length;n=0;for(;n<t;n++){b.on(e[n],"click",function(e){e.stopPropagation()})}}function switchToCurA(){var e=p.getModule(_curModuleId);if(e!=null&&e.pageList.length!=0&&e.pageList[0].actionList.length!=0){ws.switchA(e.pageList[0].actionList[0].id,_curModuleId)}else{var t=b.g("div-a-"+_curModuleId);if(t){t.innerHTML=""}_curActionId=-1}}function setEmptyView(e,t){if(e){b.show("div-empty-hint");b.hide("div-add-p");_curModuleId=-1}else{b.hide("div-empty-hint");b.show("div-add-p");_curModuleId=t}}function initModules(){var e=b.g("div-m-list"),t=b.g("div-mt-list"),n=p.getModuleList(),r=n.length,i,s,o="",u="";e.innerHTML="";t.innerHTML="";if(n.length==0){setEmptyView(true)}else{_curModuleId=n[0].id;o+=getMHtml(n[0]);u+=getMTHtml(n[0],true);for(s=1;s<r;s++){i=n[s];o+=getMHtml(n[s]);u+=getMTHtml(n[s]);if(s==0)_curModuleId=i.id}}if(_isEditMode){u+=TEMPLATE.MODULE_ADD_BUTTON}e.innerHTML=o;t.innerHTML=u;ws.switchM(_curModuleId);renderModuleTreeList()}function initSavePanel(){var e=b.g(ELEMENT_ID.SAVE_PANEL_CONTENT);var t=_data.saveList;e.innerHTML=getSavePanelHtml(t)}function initVersionPanel(){var e=b.g(ELEMENT_ID.VERSION_PANEL_CONTENT);var t=_data.checkList;e.innerHTML=getVersionPanelHtml(t)}function cancelEdit(){if(!isEditing())return;var e=stopEditing(),t;switch(e.key){case"mt":t=getDiv(e.id,e.key);break;case"param-name":case"param-identifier":case"param-validator":case"param-remark":t=getTd(e.id,e.key);break;default:throw Error("not implemented, key:"+key)}processInputEvent(false);t.innerHTML=e.content;if(isEditing()){stopEditing()}}function bind(e){if(!e&&!processing())return;showMessage(CONST.LOADING,ELEMENT_ID.WORKSPACE_MESSAGE,MESSAGE.LOADING);_curModuleId=-1;_curActionId=-1;_doesSoFarNoActionDisplay=true;_editContext=null;_messageContainerId="";_messageTimer=null;_isProcessing;_isEditMode=false;_deletedObjectList=[];p.init(_data.projectData);delete _data.projectData;if(true){}else if(_data.modeInt==2){initSavePanel()}initVersionPanel();initModules();showMessage(CONST.LOAD,ELEMENT_ID.WORKSPACE_MESSAGE,MESSAGE.MODULE_LOAD);processed()}function isEditing(){return _editContext!=null}function editing(e,t,n){_editContext={id:e,content:t,key:n}}function stopEditing(){if(_editContext==null){throw Error("no edit view, can not stop")}var e=_editContext;_editContext=null;return e}function clearMessage(){var e=b.g(_messageContainerId);if(e==null)return;b.hide(e);e.innerHTML="";_messageTimer=null;_messageContainerId=""}function getSelectedSave(){var e=null,t,n,r=_data.saveList;if(r==null||r.length==0)return null;n=r.length;for(var i=0;i<n;i++){e=r[i];t=b.g(PREFIX.SAVE+e.id);if(t!=null&&t.checked){return e}}return null}function processing(e){if(_isProcessing){showMessage(CONST.WARN,e==null?ELEMENT_ID.WORKSPACE_MESSAGE:e,MESSAGE.DO_NOT_DOUBLE_CLICK);return false}_isProcessing=true;return true}function processed(){if(_isProcessing){_isProcessing=false;return true}return false}function showMessage(e,t,n){if(_messageTimer!=null){clearMessage()}var r=b.g(t);if(r==null)return;var i=["label-success","label-warning","label-important","label-info","label-inverse"],s=i.length,o=0;for(;o<s;o++){b.dom.hasClass(r,i[o])&&b.dom.removeClass(r,i[o])}switch(e){case CONST.WARN:b.dom.addClass(r,"label-important");break;case CONST.LOADING:b.dom.addClass(r,"label-info");break;case CONST.LOAD:b.dom.addClass(r,"label-success");break;default:break}r.innerHTML=n;b.show(r);_messageContainerId=t;_messageTimer=setTimeout(clearMessage,CONFIG.MESSAGE_TIMEOUT)}function getBackgroundStyle(e){return'url("'+URL.imageRoot+e+'") no-repeat'}function initEditAFloater(){b.g("editAFloater-id").value="";b.g("editAFloater-name").value="";b.g("editAFloater-requestUrl").value="";b.g("editAFloater-responseTemplate").value="";b.g("editAFloater-description").value="";b.g("editAFloater-pageId").value="";initRadioList("editAFloater-type")}function initSaveVSSFloater(){b.g("txtDescription").value="";b.g("divVersion").innerHTML=p.getVersion()+" -> "+versionUpgrade(p.getVersion(),4);e.get("saveVSSFloater").setTitle("提交您的修改");ecFloater.show("saveVSSFloater");initRadioList("radioVersion");setSelectedValue("radioVersion",4)}function versionUpgrade(e,t){var n=e.split(".");if(n.length!=4){throw Error("error version format:"+e)}else if(!(t<=4&&t>=1)){throw Error("error version position: "+t)}var r=n[t-1];r=r-0+1;n[t-1]=r;var e="";for(var i=0;i<n.length;i++){e+=n[i];if(i<n.length-1){e+="."}}return e}function initEditPFloater(){b.g("editPFloater-id").value="";b.g("editPFloater-name").value="";b.g("editPFloater-introduction").value="";b.g("editPFloater-moduleId").value=""}function initRadioList(e){var t=document.getElementsByName(e),n=t.length;for(var r=0;r<n;r++){if(t[r].checked){t[r].checked=false}if(r==0){t[r].checked=true}}}function getSelectedValue(e){var t=document.getElementsByName(e),n=t.length;for(var r=0;r<n;r++){if(t[r].checked){return t[r].value}}return null}function setSelectedValue(e,t){var n=document.getElementsByName(e),r=n.length;for(var i=0;i<r;i++){var s=n[i];if(s.checked){s.checked=false}if(s.value==t){s.checked=true}}}function updateCurMTree(){var t=p.getModule(_curModuleId);if(t==null)return;storeViewState();b.dom.remove(b.g("div-tree-"+_curModuleId));b.g("div-m-"+_curModuleId).innerHTML=getMTreeHtml(t)+b.g("div-m-"+_curModuleId).innerHTML;e.init(b.g("div-m-"+_curModuleId));switchToCurA();recoverViewState()}function renderModuleTreeList(){var e=p.getModuleList(),t=e.length,n=0,r=0;for(;n<t;n++){r=e[n].id;ecui.init(baidu.g("div-tree-"+r))}}function processJSONImport(e,t,n,r){var i,s,o;if(r){if(!n){i=p.addResponseParameter(_curActionId);s=p.getParameter(i);s.identifier=t}else{i=p.addChildParameter(n);s=p.getParameter(i);s.identifier=t}}var u;var a;if(e instanceof Array&&e.length){if(r){o=e[0];a=e[0];if(typeof a==="string"){s.dataType="array<string>";s.remark="@value="+e}else if(typeof a==="number"){s.dataType="array<number>";s.remark="@value="+e}else if(typeof a==="boolean"){s.dataType="array<boolean>";s.remark="@value="+e}else if(e!==null&&typeof a==="object"){s.dataType="array<object>";for(u in o){processJSONImport(o[u],u,r?i:null,true)}}}}else if(typeof e==="string"){if(s){s.dataType="string";s.remark="@value="+e}}else if(typeof e==="number"){if(s){s.dataType="number";s.remark="@value="+e}}else if(typeof e==="boolean"){if(s){s.dataType="boolean";s.remark="@value="+e}}else if(typeof e==="undefined"){}else if(e===null){}else if(typeof e==="object"){s&&(s.dataType="object");for(u in e){processJSONImport(e[u],u,r?i:null,true)}}}function getMHtml(e){var t="";t+='<div class="m clearfix" id="div-m-'+e.id+'">';t+=getMTreeHtml(e);t+=TEMPLATE.SEPERATOR;t+=getMTableHtml(e);t+="</div>";return t}function getMTreeHtml(e){var t="",n=e.pageList,r=n.length;t+='<div id="div-tree-'+e.id+'" class="tree-m">';t+='<div class="more" ecui="type:tree;id:moduleTree'+e.id+'">';t+="<label>"+util.escaper.escapeInH(e.name);if(_isEditMode){t+='&nbsp;&nbsp;<a href="#" class="del-link" onclick="ws.removeM(); return false;">&nbsp;</a>'}t+="</label>";for(var i=0;i<r;i++){var s=n[i],o=s.actionList,u=o.length;t+='<div class="more">';t+='<label ondblclick="ws.editP('+s.id+'); return false;">'+util.escaper.escapeInH(s.name);if(_isEditMode){t+='<span class="div-p-control">&nbsp;&nbsp;<a href="#" class="edit-link" onclick="ws.editP('+s.id+'); return false;">&nbsp;</a><a href="#" class="del-link" onclick="ws.removeP('+s.id+'); return false;">&nbsp;</a></span>'}t+="&nbsp;&nbsp;"+(s.isIdGenerated?"":'<a class="test-link" href="'+URL.pageTester+"?id="+s.id+'" target="_blank">&nbsp;</a>');t+="</label>";for(var a=0;a<u;a++){var f=o[a];t+='<div id="div-a-tree-node-'+f.id+'">'+'<a href="#" onclick="ws.switchA('+f.id+'); return false;" ondblclick="ws.editA('+f.id+'); return false;">'+util.escaper.escapeInH(f.name)+"</a>";if(_isEditMode){t+='&nbsp;&nbsp;<a href="#" class="edit-link" onclick="ws.editA('+f.id+'); return false;">&nbsp;<a href="#" class="del-link" onclick="ws.removeA('+f.id+'); return false;">&nbsp;</a>'}t+="</div>"}if(_isEditMode){t+='<div><a class="add-link" href="#" onclick="ws.addA('+s.id+'); return false;">新增请求</a></div>'}t+="</div>"}t+="</div></div>";return t}function getMTableHtml(e){var t="";t+='<div class="div-a" id="div-a-'+e.id+'">';t+="</div>";return t}function getMTHtml(e,t){var n="";n+='<a id="a-mt-'+e.id+'" href="#" onclick="ws.switchM(';n+=e.id+'); return false;" ondblclick="ws.edit(';n+=e.id+", 'mt'); return false;\"><div class=\"tab"+(t?" first cur":"");n+='" id="div-mt-'+e.id+'">'+util.escaper.escapeInH(e.name)+"</div></a>";return n}function getAHtml(e){var t="",n=e.requestParameterList,r=e.responseParameterList,i=n.length,s=r.length,o,u;t+=getAInfoHtml(e);if(i>0){t+=_isEditMode?TEMPLATE.REQUEST_BEGIN_EDIT:TEMPLATE.REQUEST_BEGIN;for(u=0;u<i;u++){o=n[u];t+=getPTRHtml(o)}t+=TEMPLATE.REQUEST_END}if(_isEditMode){t+=TEMPLATE.REQUEST_PARAMETER_ADD_BUTTON}if(s>0){t+=_isEditMode?TEMPLATE.RESPONSE_BEGIN_EDIT:TEMPLATE.RESPONSE_BEGIN;for(u=0;u<s;u++){o=r[u];t+=getPTRHtml(o)}t+=TEMPLATE.RESPONSE_END}if(_isEditMode){t+=TEMPLATE.RESPONSE_PARAMETER_ADD_BUTTON}return t}function getAInfoHtml(e){var t="<h2 style='margin-top:30px;'>ACTION INFO</h2><div class='action-info' href='#' onclick='ws.editA("+e.id+"); return false;'>",n="",r="</div>";if(e.name){n+="<div class='item'><b>Action Name</b>: "+e.name+"(id:"+e.id+")</div>"}if(e.requestType){n+="<div class='item'><b>Request Type</b>: <font color='orange'>"+getRequestTypeStr(e.requestType)+"</font></div>"}if(e.requestUrl){n+="<div class='item'><b>Request Url</b>:<font color='blue'> "+e.requestUrl+"</font></div>"}if(e.responseTemplate){n+="<div class='item'><b>Response Template</b>: <font color='red'>"+e.responseTemplate+"</font></div>"}if(e.description){n+="<div class='item'><b>Description</b>: "+processTextarea(e.description)+"</div>"}if(!n){n+="no info"}return t+n+r}function processTextarea(e){var t=[],n=e.indexOf("@code")>-1,r=0;if(e.length>100){var i=n?e.replace(/(@code|@end)/gmi,""):e;var s=/@code([\s\S]*?)@end/gm;t[r++]="<a class=\"div-a-desc-expander\" href=\"#\" onclick=\"this.innerHTML = this.innerHTML == '展开' ? '收缩' : '展开';baidu.each(baidu.dom.query('.description-area'), function(ele){baidu.dom.toggle(ele);});baidu.each(baidu.dom.query('.description-area-partial'), function(ele){baidu.dom.toggle(ele)}); return false;\">展开</a>";t[r++]='<div class="description-area-partial">';t[r++]=i.substring(0,100);t[r++]="...</div>";t[r++]='<div class="description-area" style="display:none;">';t[r++]=e.replace(s,'<div class="js-code-area">$1</div>');t[r++]="</div>";t[r++]="</div>"}else{t[r++]=e}return t.join("")}function getRequestTypeStr(e){e=e-0;switch(e){case 1:return"get";case 2:return"post";case 3:return"get(ajax)";case 4:return"post(ajax)";default:return"unknown"}}function getPTRHtml(e,t){var n="",r=e.parameterList,i=e.parameterList&&e.parameterList.length?e.parameterList.length:0;t=t||0;n+="<tr class='tr-param"+(t>0||i>0?" param-level-"+t:"")+"' id='tr-param-"+e.id+"' onmouseover=\"ws.showOpColumn(event, "+e.id+'); return false;"'+'onmouseout="ws.hideOpColumn(event, '+e.id+'); return false;">';n+="<td class='expander'"+(_isEditMode?" style='background-color:#E6E6E6;'":"")+">";if(i>0){n+="<div style='position:relative;width:0;'><div class='more' id='div-param-expander-"+e.id+"' onclick='ws.paramShrink("+e.id+"); return false;' style='width:16px;height:18px;position: absolute;left:-22px;top:-10px;'></div></td>"}n+="</td>";if(_isEditMode){n+=getPTDHtml(e.id,'<div id="div-param-op-'+e.id+'" class="div-op-container" style="display:none;">'+'<a href="#" class="del-link" onclick="ws.removeParam('+e.id+'); return false;">&nbsp;</a>'+(i>0||e.dataType=="object"||e.dataType=="array<object>"?'<a href="#" class="add-link" onclick="ws.addParam(\'child\', '+e.id+'); return false;">&nbsp;</a>':"")+"</div>","op")}n+=getPTDHtml(e.id,util.escaper.escapeInH(e.identifier),"identifier",t);n+=getPTDHtml(e.id,util.escaper.escapeInH(e.name),"name");n+=getDataTypeEditSelectHtml(e.id,e.dataType);n+=getPTDHtml(e.id,e.remark,"remark");n+="</tr>";for(var s=0;s<i;s++){n+=getPTRHtml(r[s],t+1)}return n}function getPTDHtml(e,t,n,r){if(n==="remark"){t=remarkFilter(t);t=util.escaper.escapeInH(t)}return"<td id='td-param-"+n+"-"+e+"' class='td-param "+n+"' onclick='ws.edit("+e+', "param-'+n+"\");' >"+(r?(new Array(r+1)).join("&nbsp;&nbsp;&nbsp;&nbsp;"):"")+t+"</td>"}function remarkFilter(e){if(_isMockDisplay){return e}if(!e)return"";return e.replace(/[\s;]?@\w+=[^ ;]+[ ;]?/g,"")}function getEditInputHtml(e,t,n){return"<input id='"+ELEMENT_ID.EDIT_INPUT+"' class='edit-input' type='text' value='"+e+"' style='width: "+t+"px' maxlength='"+n+"' onblur='ws.finishEdit();' />"}function getDataTypeEditSelectHtml(e,t){var n="",r=["","number","string","object","boolean","array<number>","array<string>","array<object>","array<boolean>"],i=r.length;n+="<td id='td-param-dataType-"+e+"' class='td-param dataType'>";if(_isEditMode){n+="<select id='select-dataType-"+e+"' class='select-dataType' on"+CONFIG.KEYPRESS_EVENT_NAME+"='ws.dataTypeKeyPressed(event, "+e+");' onchange='ws.dataTypeSelectChanged("+e+", this.value);'>";for(var s=0;s<i;s++){var o=r[s];n+="<option value='"+o+"'"+(o==t?" selected='true'":"")+">"+util.escaper.escapeInH(o)+"</option>"}n+="</select>"}else{n+=util.escaper.escapeInH(t)}n+="</td>";return n}function getSavePanelHtml(e){if(e==null)return;var t=e.length,n="";t=t>=CONFIG.SAVE_LIST_MAX_LENGTH?CONFIG.SAVE_LIST_MAX_LENGTH:t;n+=TEMPLATE.SAVE_PANEL_BEGIN;for(var r=0;r<t;r++){n+=getSavePanelItemHtml(e[r])}if(t<CONFIG.SAVE_LIST_MAX_LENGTH){n+=getSavePanelItemHtml()}n+=TEMPLATE.SAVE_PANEL_END;return n}function getVersionPanelHtml(e){if(e==null)return;var t=e.length,n="";n+=TEMPLATE.VERSION_PANEL_BEGIN;for(var r=0;r<t;r++){n+=getVersionPanelItemHtml(e[r])}n+=TEMPLATE.VERSION_PANEL_END;return n}function getSavePanelItemHtml(e){var t="",n=e==null;t+="<div class='item'><input name='radio-save' type='radio' value='' group='save-panel' "+(n?"":"id='"+PREFIX.SAVE+e.id+"'")+"/>"+(n?"新增存档":"存档:"+e.id+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;更新时间: "+e.updateDate)+"</div>";return t}function getVersionPanelItemHtml(e){var t="";t+="<tr class='table-row'>";t+="<td><input name='radioCheckIn' type='radio' group='radioCheckInGroup' value='"+e.id+"' /></td>";t+="<td class='version'>"+e.version+"</td>";t+="<td class='operator'>"+util.escaper.escapeInH(e.userName)+"</td>";t+="<td class='operation-time'>"+e.createDateStr+"</td>";t+="<td class='version-desc' >"+util.escaper.escapeInH(e.description)+"</td>";t+="</tr>";return t}rap.workspace=rap.workspace||{};var ws=rap.workspace,p=rap.project,util=rap.util,b=baidu,e=ecui,_curModuleId,_data,_curActionId,_isProcessing,_messageTimer,_messageContainerId,_sessionDelayTimer,_doesSoFarNoActionDisplay,_editContext,_isEditMode,_deletedObjectList,_viewState,_debugCounter,_isLocalStorageEnabled,_isMockDisplay,URL=null,MESSAGE={CONFIRM_COVER:"是否确定覆盖旧的内容?",CONFIRM_SAVE:"是否确认保存?",CONFIRM_CANCEL:"是否确定取消?",CONFIRM_CHECKIN:"是否确定提交?",CONFIRM_CHECKOUT:"是否确定获取?",CHECK_LOCK_CONFLICKTION:"正在为您检查工作区锁定状态...",CHECK_LOCK_CONFLICKTION_COMPLETED:"您已成功切换至编辑状态，该项目已被您锁定。",CHOOSE_AT_FIRST:"请先选择您要操作的选项.",SAVE_LIST_MAX_LENGTH_OVERFLOW:"您的存档空间已满，请删除不必要的存档，或覆盖旧的存档。",CONFIRM_DELETE:"您是否确认删除?",LOADING:"加载中...",LOAD:"已完成加载",MODULE_LOADING:"正在加载项目模块...",MODULE_LOAD:"项目模块加载完成",VERSION_LOADING:"正在请求版本信息...",VERSION_LOAD:"版本信息已加载",VERSION_EXIT:"已退出版本观看模式",VERSION_SWITCHING:"正在为您切换版本...",VERSION_SWITCHED:"版本切换成功",VERSION_SWITCH_ERROR:"版本切换中发生错误，已恢复至切换前",SAVING:"正在保存...",SAVED:"保存成功",DELETING:"正在删除...",DELETED:"删除成功",PROCESSING:"正在处理中,请稍后...",PROCESSED:"处理成功",ERROR:"出现错误，请稍后重试。",DO_NOT_DOUBLE_CLICK:"您的请求正在处理，请勿重复点击。",FATAL_ERROR:"发生严重错误，请联系维护人员并保留现场。",SESSION_DELAY_ERROR:"Session延时发生异常，建议您立即保存工作区并联系维护人员."},TEMPLATE={REQUEST_BEGIN:'<h2>REQUEST PARAM LIST</h2><table class="table-a"><tr class="head"><td class="head-expander"></td><td class="head-identifier">变量名</td><td class="head-name">含义</td><td class="head-type">类型</td><td class="head-remark">备注</td></tr>',REQUEST_BEGIN_EDIT:'<h2>REQUEST PARAM LIST</h2><table class="table-a"><tr class="head"><td class="head-expander"></td><td class="head-op">OP</td><td class="head-identifier">变量名</td><td class="head-name">含义</td><td class="head-type">类型</td><td class="head-remark">备注</td></tr>',REQUEST_END:"</table>",REQUEST_PARAMETER_ADD_BUTTON:'<div><a href="#" class="add-link div-add-param-link" onclick="ws.addParam(\'request\'); return false;">新增请求参数</a></div>',RESPONSE_BEGIN:'<br /><h2>RESPONSE PARAM LIST</h2><table class="table-a"><tr class="head"><td class="head-expander"></td><td class="head-identifier">变量名</td><td class="head-name">含义</td><td class="head-type">类型</td><td class="head-remark">备注</td></tr>',RESPONSE_BEGIN_EDIT:'<br /><h2>RESPONSE PARAM LIST</h2><table class="table-a"><tr class="head"><td class="head-expander"></td><td class="head-op">OP</td><td class="head-identifier">变量名</td><td class="head-name">含义</td><td class="head-type">类型</td><td class="head-remark">备注</td></tr>',RESPONSE_END:"</table>",RESPONSE_PARAMETER_ADD_BUTTON:'<div><a href="#" class="add-link div-add-param-link" onclick="ws.addParam(\'response\'); return false;">新增响应参数</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href"#" onclick="ws.importJSON(); return false;">导入JSON</a></div>',SAVE_PANEL_BEGIN:'<div id="div-save-panel">',SAVE_PANEL_END:"</div>",VERSION_PANEL_BEGIN:"<div id=\"div-version-panel\"><table class='table-version'><tr class='head'><td class='version-op'>OP</td><td class='version'>版本</td><td class='operator'>操作人</td><td class='operation-time'>操作时间</td><td class='version-desc'>描述</td></tr>",VERSION_PANEL_END:"</table></div>",MODULE_ADD_BUTTON:'<div id="div-add-m"><a href="#" class="add-link" onclick="ws.addM(); return false;">&nbsp;</a></div>',SEPERATOR:'<div class="seperator"></div>',NO_DATA_CHECKED:"<div class='log-item'><font color='gray'>没有可获取或更新的数据</font></div>"},CONFIG={SAVE_LIST_MAX_LENGTH:10,DEFAULT_MAX_LENGTH:50,REMARK_MAX_LENGTH:9999,DEFAULT_INPUT_WIDTH:100,MODULE_NAME_WIDTH:100,PARAMETER_NAME_WIDTH:160,PARAMETER_IDENTIFIER_WIDTH:160,PARAMETER_TYPE_WIDTH:110,PARAMETER_REMARK_WIDTH:300,MESSAGE_TIMEOUT:5e3,SESSION_DELAY_TIMESPAN:3e5,KEYPRESS_EVENT_NAME:baidu.browser.firefox?"keypress":"keydown"},CONST={WARN:"warn",ERROR:"error",LOADING:"loading",LOAD:"load",NORMAL:"normal",EDIT:"edit",VERSION:"version"},ELEMENT_ID={SAVE_PANEL:"saveFloater",SAVE_PANEL_CONTENT:"div-save-floater-content",SAVE_PANEL_MESSAGE:"div-save-floater-message",VERSION_PANEL:"versionFloater",VERSION_PANEL_MESSAGE:"div-version-floater-message",VERSION_PANEL_CONTENT:"div-version-floater-content",CHECKOUT_PANEL:"checkoutFloater",CHECKOUT_PANEL_CONTENT:"div-checkout-floater-content",CHECKOUT_PANEL_MESSAGE:"div-checkout-floater-message",CHECKIN_PANEL:"checkinFloater",CHECKIN_PANEL_CONTENT:"div-checkin-floater-content",CHECKIN_PANEL_MESSAGE:"div-checkin-floater-message",VSS_PANEL_MESSAGE:"div-saveVSS-floater-message",WORKSPACE_MESSAGE:"div-w-message",EDIT_INPUT:"txtMTName",IMPORT_JSON_MESSAGE:"div-importJSON-floater-message"},PREFIX={SAVE:"radio-save-"};ws.init=function(e,t){_isLocalStorageEnabled=typeof localStorage!="undefined";_isMockDisplay=false;URL=t;try{_data=e;_data.projectDataOriginal=b.object.clone(_data.projectData)}catch(n){showMessage(CONST.WARN,ELEMENT_ID.WORKSPACE_MESSAGE,MESSAGE.FATAL_ERROR)}b.dom.ready(function(){_sessionDelayTimer=setInterval(sessionDelay,CONFIG.SESSION_DELAY_TIMESPAN);_viewState={moduleId:-1,pageId:-1,actionId:-1,parameterId:-1};_debugCounter=1;window.onbeforeunload=function(){if(_isEditMode){if(_isLocalStorageEnabled){localStorage.setItem("_data",b.json.stringify(_data))}return"现在退出所有修改都将丢失，确认退出？"}};bind();ecui.ui.Tree.prototype.onclick=function(e){return e.target==this.getBase()}})};ws._getData=function(){return _data};ws.switchM=function(e){if(e<0){setEmptyView(true);return}var t=getDiv(_curModuleId,"m"),n=getDiv(_curModuleId,"mt"),r=getDiv(e,"m"),i=getDiv(e,"mt");if(r&&i){if(t&&n){t.style.display="";b.dom.removeClass(n,"cur")}r.style.display="block";b.dom.addClass(i,"cur")}_curModuleId=e;switchToCurA()};ws.switchA=function(e,t){if(!t){if(!p.isActionInModule(e,_curModuleId))return}var n=p.getAction(e);if(n==null)return;getDiv(_curModuleId,"a").innerHTML=getAHtml(n);renderA();_curActionId=e};ws.addM=function(){var e=b.g("div-m-list"),t=b.g("div-mt-list"),n=p.addModule(),r=p.getModule(n);if(isEditing()){cancelEdit()}if(p.getModuleList().length==1){setEmptyView(false,n)}e.innerHTML+=getMHtml(r);b.dom.insertHTML("div-add-m","beforeBegin",getMTHtml(r));ws.switchM(n);ws.edit(n,"mt")};ws.addParam=function(e,t){var n=-1;if(e=="child"){n=p.addChildParameter(t)}else if(e=="request"){n=p.addRequestParameter(_curActionId)}else if(e=="response"){n=p.addResponseParameter(_curActionId)}else{throw new Error("unkown type: "+e+" in ws.addParam(type, parentParamId);")}this.finishEdit();this.switchA(_curActionId);if(n>0){this.edit(n,"param-identifier")}};ws.removeM=function(){if(!confirm(MESSAGE.CONFIRM_DELETE))return;if(p.isEmpty())return;if(isEditing())cancelEdit();p.removeModule(_curModuleId);putObjectIntoDeletedPool("Module",_curModuleId);b.dom.remove(getDiv(_curModuleId,"m"));var t=b.dom.getAncestorByTag(getDivId(_curModuleId,"mt"),"a");e.dom.remove(t);var n=p.getModuleList();if(!n||n.length==0){setEmptyView(true)}else{ws.switchM(n[n.length-1].id)}};ws.removeA=function(e){if(!confirm(MESSAGE.CONFIRM_DELETE))return;p.removeAction(e);putObjectIntoDeletedPool("Action",e);b.dom.remove(b.g("div-a-tree-node-"+e));if(e==_curActionId){switchToCurA()}};ws.removeP=function(e){if(!confirm(MESSAGE.CONFIRM_DELETE))return;p.removePage(e);putObjectIntoDeletedPool("Page",e);updateCurMTree()};ws.removeParam=function(e){p.removeParameter(e);putObjectIntoDeletedPool("Parameter",e);ws.switchA(_curActionId)};ws.edit=function(e,t){var n,r="",i,s=CONFIG.DEFAULT_INPUT_WIDTH;if(!_isEditMode||t=="param-op"){return}if(isEditing()){if(_editContext.id==e&&_editContext.key==t){return}else{this.finishEdit()}}switch(t){case"mt":s=CONFIG.MODULE_NAME_WIDTH;n=getDiv(e,t);i=b.trim(n.innerHTML);r+=getEditInputHtml(i,s,CONFIG.DEFAULT_MAX_LENGTH);break;case"param-name":s=CONFIG.PARAMETER_NAME_WIDTH;n=getTd(e,t);i=b.trim(n.innerHTML);r+=getEditInputHtml(i,s,CONFIG.DEFAULT_MAX_LENGTH);break;case"param-identifier":s=CONFIG.PARAMETER_IDENTIFIER_WIDTH;n=getTd(e,t);i=b.trim(n.innerHTML);r+=getEditInputHtml(i,s,CONFIG.DEFAULT_MAX_LENGTH);break;case"param-validator":n=getTd(e,t);i=b.trim(n.innerHTML);r+=getEditInputHtml(i,s,CONFIG.DEFAULT_MAX_LENGTH);break;case"param-remark":s=CONFIG.PARAMETER_REMARK_WIDTH;n=getTd(e,t);i=b.trim(p.getParameter(e).remark);r+=getEditInputHtml(i,s,CONFIG.REMARK_MAX_LENGTH);break;default:throw Error("not implemented, key:"+t)}editing(e,i,t);n.innerHTML=r;processInputEvent(true);focusElement(b.g(ELEMENT_ID.EDIT_INPUT))};ws.validate=function(){showMessage(CONST.LOADING,ELEMENT_ID.WORKSPACE_MESSAGE,MESSAGE.PROCESSING);if(!processing())return;setTimeout(function(){ecFloater.show("validateFloater");e.get("validateFloater").setTitle("Validate Workspace");showMessage(CONST.LOAD,ELEMENT_ID.WORKSPACE_MESSAGE,MESSAGE.PROCESSED);processed()},5e3)};ws.save=function(){if(!processing())return;ecFloater.show(ELEMENT_ID.SAVE_PANEL);e.get(ELEMENT_ID.SAVE_PANEL).setTitle("Save Workspace");processed()};ws.version=function(){if(!processing())return;e.get(ELEMENT_ID.VERSION_PANEL).setTitle("版本管理");ecFloater.show(ELEMENT_ID.VERSION_PANEL);setSelectedValue("radioCheckIn",-1);var t=b.g("div-version-panel");if(t){t.scrollTop=0}processed()};ws._processed=function(){processed()};ws.checkIn=function(){if(!confirm(MESSAGE.CONFIRM_CHECKIN))return;ecFloater.show(ELEMENT_ID.CHECKIN_PANEL);ecui.get(ELEMENT_ID.CHECKIN_PANEL).setTitle("Check In");var q="projectId="+p.getId()+"&projectData="+util.escaper.escapeInU(b.json.stringify(p.getData()))+"&projectDataOriginal="+util.escaper.escapeInU(b.json.stringify(_data.projectDataOriginal));showMessage(CONST.LOADING,ELEMENT_ID.CHECKIN_PANEL_MESSAGE,MESSAGE.PROCESSING);if(!processing())return;b.ajax.post(URL.checkIn,q,function(xhr,response){try{var obj=eval("("+response+")");p.init(obj.projectData);_data.projectDataOriginal=b.object.clone(obj.projectData);b.g(ELEMENT_ID.CHECKIN_PANEL_CONTENT).innerHTML=obj.log?obj.log:TEMPLATE.NO_DATA_CHECKED;bind(true);showMessage(CONST.LOAD,ELEMENT_ID.CHECKIN_PANEL_MESSAGE,MESSAGE.PROCESSED)}catch(e){showMessage(CONST.WARN,ELEMENT_ID.CHECKIN_PANEL_MESSAGE,MESSAGE.FATAL_ERROR)}finally{processed()}})};ws.closeSavePanel=function(){e.get(ELEMENT_ID.SAVE_PANEL).hide()};ws.closeVersionPanel=function(){e.get(ELEMENT_ID.VERSION_PANEL).hide()};ws.closeCheckOutPanel=function(){b.g(ELEMENT_ID.CHECKOUT_PANEL_MESSAGE).innerHTML="";b.g(ELEMENT_ID.CHECKOUT_PANEL_CONTENT).innerHTML="";ecui.get(ELEMENT_ID.CHECKOUT_PANEL).hide()};ws.closeCheckInPanel=function(){b.g(ELEMENT_ID.CHECKIN_PANEL_MESSAGE).innerHTML="";b.g(ELEMENT_ID.CHECKIN_PANEL_CONTENT).innerHTML="";ecui.get(ELEMENT_ID.CHECKIN_PANEL).hide()};ws.dataTypeSelectChanged=function(e,t){p.setParameter(e,t,"dataType");if(t=="object"||t=="array<object>"){this.switchA(_curActionId)}};ws.radioVersionChanged=function(e){b.g("divVersion").innerHTML=p.getVersion()+" -> "+versionUpgrade(p.getVersion(),e)};ws.dataTypeKeyPressed=function(e,t){if(b.event.getKeyCode(e)==9){this.edit(t,"param-remark")}b.event.stop(e)};ws.finishEdit=function(t){if(!isEditing())return;var n=b.g(ELEMENT_ID.EDIT_INPUT);if(!n)return;var r=stopEditing(),i=b.trim(n.value),s=false,o;switch(r.key){case"mt":o=getDiv(r.id,r.key);p.setModuleName(r.id,i);updateCurMTree();break;case"param-name":case"param-identifier":case"param-validator":case"param-remark":o=getTd(r.id,r.key);var u=r.key;p.setParameter(r.id,i,u.substring(6,u.length));if(r.key==="param-remark"){i=remarkFilter(i)}break;default:throw Error("not implemented finish edit for key:"+r.key)}processInputEvent(false);var a=r.id;e.dom.setText(o,i);if(isEditing()){stopEditing()}return a};ws.doAddOrEditA=function(){if(!validate("formEditAFloater"))return;if(b.g("editAFloater-id").value==""){this.doAddA()}else{this.doEditA()}};ws.doAddOrEditP=function(){if(!validate("formEditPFloater"))return;if(b.g("editPFloater-id").value==""){this.doAddP()}else{this.doEditP()}};ws.doImportJSON=function(){if(!validate("formImportJSONFloater"))return;var e=b.g("importJSONFloater-text");var t=e.value;try{if(typeof JSON==="undefined"){alert("您用的啥浏览器啊？连JSON转换都不支持也～～～请考虑用新浏览器试试？谢谢啦，mua~~~!");return}var n=JSON.parse(t);e.value="";processJSONImport(n);this.switchA(_curActionId);this.cancelImportJSON()}catch(r){showMessage(CONST.WARN,ELEMENT_ID.IMPORT_JSON_MESSAGE,"JSON解析错误: "+r.message)}};ws.editA=function(t){if(!_isEditMode)return;var n=p.getAction(t);initEditAFloater();b.g("editAFloater-id").value=n.id;b.g("editAFloater-name").value=n.name;setSelectedValue("editAFloater-type",n.requestType);b.g("editAFloater-requestUrl").value=n.requestUrl;b.g("editAFloater-responseTemplate").value=n.responseTemplate;b.g("editAFloater-description").value=n.description;e.get("editAFloater").setTitle("模型管理 - 编辑请求");ecFloater.show("editAFloater")};ws.editP=function(t){if(!_isEditMode)return;var n=p.getPage(t);initEditPFloater();b.g("editPFloater-id").value=n.id;b.g("editPFloater-name").value=n.name;b.g("editPFloater-introduction").value=n.introduction;e.get("editAFloater").setTitle("模型管理 - 编辑页面");ecFloater.show("editPFloater")};ws.addA=function(t){initEditAFloater();b.g("editAFloater-pageId").value=t;e.get("editAFloater").setTitle("模型管理 - 添加新请求");ecFloater.show("editAFloater")};ws.addP=function(){initEditPFloater();e.get("editPFloater").setTitle("模型管理 - 添加新页面");ecFloater.show("editPFloater")};ws.doEditA=function(e){var t={};t.id=b.g("editAFloater-id").value-0;t.name=b.g("editAFloater-name").value;t.requestType=getSelectedValue("editAFloater-type");t.requestUrl=b.g("editAFloater-requestUrl").value;t.responseTemplate=b.g("editAFloater-responseTemplate").value;t.description=b.g("editAFloater-description").value;p.updateAction(t);updateCurMTree();ws.cancelEditA()};ws.doAddA=function(){var e={};e.pageId=b.g("editAFloater-pageId").value-0;e.name=b.g("editAFloater-name").value;e.requestType=getSelectedValue("editAFloater-type");e.requestUrl=b.g("editAFloater-requestUrl").value;e.responseTemplate=b.g("editAFloater-responseTemplate").value;e.description=b.g("editAFloater-description").value;var t=p.addAction(e);updateCurMTree();ws.cancelEditA();this.switchA(t)};ws.doAddP=function(){var e={};e.moduleId=_curModuleId;e.name=b.g("editPFloater-name").value;e.introduction=b.g("editPFloater-introduction").value;p.addPage(e);updateCurMTree();ws.cancelEditP()};ws.doEditP=function(e){var t={};t.id=b.g("editPFloater-id").value-0;t.name=b.g("editPFloater-name").value;t.introduction=b.g("editPFloater-introduction").value;p.updatePage(t);updateCurMTree();ws.cancelEditP()};ws.cancelEditA=function(){ecui.get("editAFloater").hide()};ws.cancelEditP=function(){ecui.get("editPFloater").hide()};ws.cancelImportJSON=function(){ecui.get("importJSONFloater").hide()};ws.importJSON=function(){ecFloater.show("importJSONFloater")};ws.cancelSaveVSS=function(){ecui.get("saveVSSFloater").hide()};ws.switchToEditMode=function(){var q="id="+p.getId();showMessage(CONST.LOADING,ELEMENT_ID.WORKSPACE_MESSAGE,MESSAGE.CHECK_LOCK_CONFLICKTION);if(!processing(ELEMENT_ID.WORKSPACE_MESSAGE))return;b.ajax.post(URL.lock,q,function(xhr,response){try{var obj=eval("("+response+")");if(obj.isOk){storeViewState();p.init(obj.projectData);_data.projectDataOriginal=b.object.clone(obj.projectData);setButtonsViewState(CONST.EDIT);_isEditMode=true;initModules();renderModuleTreeList();recoverViewState();showMessage(CONST.LOAD,ELEMENT_ID.WORKSPACE_MESSAGE,MESSAGE.CHECK_LOCK_CONFLICKTION_COMPLETED)}else{showMessage(CONST.WARN,ELEMENT_ID.WORKSPACE_MESSAGE,obj.errMsg)}}catch(e){showMessage(CONST.WARN,ELEMENT_ID.WORKSPACE_MESSAGE,MESSAGE.FATAL_ERROR)}finally{processed()}})};ws.switchToViewMode=function(e){storeViewState();if(e){initSaveVSSFloater()}else{if(!confirm(MESSAGE.CONFIRM_CANCEL))return;var t="id="+p.getId();b.ajax.post(URL.unlock,t,function(e,t){});p.init(b.object.clone(_data.projectDataOriginal));switchToViewModeSub()}};ws.quickSave=function(){var q="id="+p.getId()+"&projectData="+util.escaper.escapeInU(getProjectDataJson())+"&deletedObjectListData="+util.escaper.escapeInU(b.json.stringify(_deletedObjectList))+"&versionPosition=4&description=quick save";showMessage(CONST.LOADING,ELEMENT_ID.WORKSPACE_MESSAGE,MESSAGE.SAVING);if(!processing(ELEMENT_ID.WORKSPACE_MESSAGE))return;b.ajax.post(URL.checkIn,q,function(xhr,response){try{var obj=eval("("+response+")");if(obj.isOk){p.init(obj.projectData);_data.projectDataOriginal=b.object.clone(obj.projectData);_data.checkList=obj.checkList;initVersionPanel();switchToViewModeSub();ws.cancelSaveVSS();showMessage(CONST.LOAD,ELEMENT_ID.WORKSPACE_MESSAGE,MESSAGE.SAVED)}else{showMessage(CONST.WARN,ELEMENT_ID.WORKSPACE_MESSAGE,obj.errMsg)}}catch(e){showMessage(CONST.WARN,ELEMENT_ID.WORKSPACE_MESSAGE,MESSAGE.FATAL_ERROR)}finally{processed()}});};ws.doSaveVSS=function(){if(!validate("formSaveVSSFloater"))return;var q="id="+p.getId()+"&projectData="+util.escaper.escapeInU(getProjectDataJson())+"&deletedObjectListData="+util.escaper.escapeInU(b.json.stringify(_deletedObjectList))+"&versionPosition="+getSelectedValue("radioVersion")+"&description="+b.g("txtDescription").value;showMessage(CONST.LOADING,ELEMENT_ID.VSS_PANEL_MESSAGE,MESSAGE.SAVING);if(!processing(ELEMENT_ID.VSS_PANEL_MESSAGE))return;b.ajax.post(URL.checkIn,q,function(xhr,response){try{var obj=eval("("+response+")");if(obj.isOk){p.init(obj.projectData);_data.projectDataOriginal=b.object.clone(obj.projectData);_data.checkList=obj.checkList;initVersionPanel();switchToViewModeSub();ws.cancelSaveVSS();showMessage(CONST.LOAD,ELEMENT_ID.WORKSPACE_MESSAGE,MESSAGE.SAVED)}else{showMessage(CONST.WARN,ELEMENT_ID.VSS_PANEL_MESSAGE,obj.errMsg)}}catch(e){showMessage(CONST.WARN,ELEMENT_ID.VSS_PANEL_MESSAGE,MESSAGE.FATAL_ERROR)}finally{processed()}})};ws.showOpColumn=function(e,t){if(!_isEditMode)return;b.show("div-param-op-"+t);b.event.stop(e)};ws.hideOpColumn=function(e,t){if(!_isEditMode)return;b.hide("div-param-op-"+t);b.event.stop(e)};ws.readProjectOfVersion=function(){var versionId=getSelectedValue("radioCheckIn");if(!versionId){showMessage(CONST.WARN,ELEMENT_ID.VERSION_PANEL_MESSAGE,MESSAGE.CHOOSE_AT_FIRST);return}var q="versionId="+versionId;showMessage(CONST.LOADING,ELEMENT_ID.VERSION_PANEL_MESSAGE,MESSAGE.VERSION_LOADING);if(!processing(ELEMENT_ID.VERSION_PANEL_MESSAGE))return;b.ajax.post(URL.queryVersion,q,function(xhr,response){try{var obj=eval("("+response+")");p.init(obj.projectData);setButtonsViewState(CONST.VERSION);_isEditMode=false;initModules();ws.closeVersionPanel();showMessage(CONST.LOAD,ELEMENT_ID.WORKSPACE_MESSAGE,MESSAGE.VERSION_LOAD)}catch(e){showMessage(CONST.WARN,ELEMENT_ID.WORKSPACE_MESSAGE,MESSAGE.FATAL_ERROR)}finally{processed()}})};ws.exitVersion=function(){p.init(_data.projectDataOriginal);setButtonsViewState(CONST.NORMAL);_isEditMode=false;initModules();showMessage(CONST.LOAD,ELEMENT_ID.WORKSPACE_MESSAGE,MESSAGE.VERSION_EXIT)};ws.switchVersion=function(){if(!confirm("确定要恢复到另一版本吗？"))return;var versionId=getSelectedValue("radioCheckIn");if(!versionId){showMessage(CONST.WARN,ELEMENT_ID.VERSION_PANEL_MESSAGE,MESSAGE.CHOOSE_AT_FIRST);return}var q="versionId="+versionId;showMessage(CONST.LOADING,ELEMENT_ID.VERSION_PANEL_MESSAGE,MESSAGE.VERSION_SWITCHING);if(!processing(ELEMENT_ID.VERSION_PANEL_MESSAGE))return;b.ajax.post(URL.switchVersion,q,function(xhr,response){try{var obj=eval("("+response+")");if(obj.isOk){p.init(obj.projectData);showMessage(CONST.LOAD,ELEMENT_ID.WORKSPACE_MESSAGE,MESSAGE.VERSION_SWITCHED)}else{throw Error()}}catch(e){showMessage(CONST.WARN,ELEMENT_ID.WORKSPACE_MESSAGE,MESSAGE.VERSION_SWITCH_ERROR);p.init(_data.projectDataOriginal)}finally{setButtonsViewState(CONST.NORMAL);_isEditMode=false;initModules();ws.closeVersionPanel();processed()}})};ws.paramShrink=function(e){hideAllChildParameters(p.getParameter(e));var t=b.g("div-param-expander-"+e);if(t){t.onclick=function(){ws.paramExpand(e);return false};b.dom.removeClass(t,"more");b.dom.addClass(t,"more-fold")}};ws.paramExpand=function(e){showAllChildParameters(p.getParameter(e));var t=b.g("div-param-expander-"+e);if(t){t.onclick=function(){ws.paramShrink(e);return false};b.dom.removeClass(t,"more-fold");b.dom.addClass(t,"more")}};ws.toggleMockDisplay=function(){b.g("btnToggleMockDisplay").value=(_isMockDisplay?"显示":"隐藏")+"Mock标签";_isMockDisplay=!_isMockDisplay;ws.switchA(_curActionId,true)};})()